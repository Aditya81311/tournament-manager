{% extends "base.html" %}
{% block title %}Leaderboard - Esports Tournament Manager{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h1><i class="bi bi-bar-chart"></i> Leaderboard</h1>
</div>

<!-- Filter -->
<div class="card mb-4">
  <div class="card-body">
    <form method="GET" action="{{ url_for('leader_board') }}" class="row g-3 align-items-end">
      <div class="col-md-10">
        <label class="form-label fw-semibold">Filter by Tournament</label>
        <select class="form-select" name="tournament_id" onchange="this.form.submit()">
          <option value="">All Tournaments (Overall Rankings)</option>
          {% for tournament in tournaments %}
          <option value="{{ tournament.tournament_id }}"
            {% if selected_tournament and selected_tournament|int == tournament.tournament_id %}selected{% endif %}>
            {{ tournament.tournament_name }} — {{ tournament.start_date or 'TBD' }}
          </option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-2">
        <button type="submit" class="btn btn-primary w-100">
          <i class="bi bi-filter"></i> Filter
        </button>
      </div>
    </form>
  </div>
</div>

{% if leaderboard %}
<div class="card mb-4">
  <div class="card-header bg-dark text-white">
    <h5 class="mb-0"><i class="bi bi-trophy"></i> Rankings</h5>
  </div>
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-hover mb-0">
        <thead class="table-dark">
          <tr>
            <th style="width:80px">Rank</th>
            <th>Team</th>
            <th>Game</th>
            {% if selected_tournament %}<th>Tournament</th>{% endif %}
            <th class="text-center">Played</th>
            <th class="text-center">Wins</th>
            <th class="text-center">Losses</th>
            <th class="text-center">Score For</th>
            <th class="text-center">Score Against</th>
            <th class="text-center">Diff</th>
            <th class="text-center">Points</th>
          </tr>
        </thead>
        <tbody>
          {% for entry in leaderboard %}
          <tr>
            <td>
              {% if loop.index == 1 %}
                <span class="badge bg-warning" style="background:linear-gradient(135deg,#FFD700,#FFA500) !important;color:#000 !important;">
                  <i class="bi bi-trophy-fill"></i> 1st
                </span>
              {% elif loop.index == 2 %}
                <span class="badge bg-secondary">
                  <i class="bi bi-trophy"></i> 2nd
                </span>
              {% elif loop.index == 3 %}
                <span class="badge" style="background:linear-gradient(135deg,#CD7F32,#a0522d) !important;color:#fff !important;">
                  <i class="bi bi-trophy"></i> 3rd
                </span>
              {% else %}
                <span class="text-muted fw-bold">{{ loop.index }}</span>
              {% endif %}
            </td>
            <td><strong>{{ entry.team_name }}</strong></td>
            <td><span class="badge bg-secondary">{{ entry.game_name }}</span></td>
            {% if selected_tournament %}<td>{{ entry.tournament_name }}</td>{% endif %}
            <td class="text-center">{{ entry.played }}</td>
            <td class="text-center"><span class="badge bg-success">{{ entry.wins }}</span></td>
            <td class="text-center"><span class="badge bg-danger">{{ entry.losses }}</span></td>
            <td class="text-center">{{ entry.score_for }}</td>
            <td class="text-center">{{ entry.score_against }}</td>
            <td class="text-center">
              {% set diff = entry.score_for - entry.score_against %}
              <span class="badge {% if diff > 0 %}bg-success{% elif diff < 0 %}bg-danger{% else %}bg-secondary{% endif %}">
                {% if diff > 0 %}+{% endif %}{{ diff }}
              </span>
            </td>
            <td class="text-center"><strong class="text-primary fs-6">{{ entry.points }}</strong></td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% else %}
<div class="alert alert-info text-center">
  <i class="bi bi-info-circle"></i> No leaderboard data available yet.
</div>
{% endif %}

<!-- Points System -->
<div class="card">
  <div class="card-header bg-info text-white">
    <h5 class="mb-0"><i class="bi bi-info-circle"></i> Points System</h5>
  </div>
  <div class="card-body">
    <ul class="mb-0">
      <li><strong>Win:</strong> 3 points</li>
      <li><strong>Loss:</strong> 0 points</li>
      <li><strong>Ranking:</strong> Sorted by points, then score difference (Score For – Score Against)</li>
    </ul>
  </div>
</div>
{% endblock %}
